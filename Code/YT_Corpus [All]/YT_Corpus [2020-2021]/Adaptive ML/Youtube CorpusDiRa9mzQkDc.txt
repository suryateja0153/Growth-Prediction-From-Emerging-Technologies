 [Music] [Music] hello everybody welcome to marketing analytics course this is dr. shallows energy from the somatic car pool who is taking this course we are in week seven and we are discussing recommendation engine so in this video and probably in the next video also we will discuss certain examples of recommendation engine and there are applications if with real-world data so in this particular data set here we have movie ratings and where people have given ratings for movies and I also have johner of the movies and I want to find out how I can recommend certain movies based on is John R and V Studies I would say entire store Doge owner data is being collected from let's say clip the IMDB or let's say Netflix or something like that so here that data set if I just read the let us say the data set looks like this there are two data sets which we will march one is called movies data set where the movie ID the title of the movie and the journals are written here and then the ratings data set where basically around 1 lakh ratings of the one left 5000 ratings are their user ID movie ID rating and timestamp at right time point this guy has given the rating so I will actually find out the so they are basically if I am NOT wrong ratings dollar user ID if I am trying to find out and then find out the unique of them so how many unique users are there if I am NOT wrong their 668 unique users yeah so they'll one two 668 unique user said there and how many movies basically there are ten thousand three hundred twenty-nine movies so that is what I have so now based on that I have to find out so which movie should be recommended now if somebody has already rated a movie then you will not see the movie anymore so then I have to find out his similar movie which he might like and likeness date however he will like or dislike a data a movie will come from basically the the the rating that this guy has provided so I will ask for a library called recommend lab and ggplot2 recommend a lab whatever we did before the item based and user based collaborative filtering this guy will do it on its own quickly for bigger data it helps so recommend allow and ggplot2 is two libraries that I am calling if you have not installed it you have to first install it and then and how to install it you can write install dot packages and then the package name or you can go here and install and write the package name here and then that will install the package so I have installed the package beforehand and I am just running this thing here so the first thing is processing of the data I will break the data into genres so for that what I am doing is I am trading on John R's column so which is a journal column only the journals of the of my data set and then I am using a library called data dot table and then in with this type very I am breaking the genre with see there is called string split so T spring Street will actually split the screen based of the genre comma 1 that means John ARS first column based on this particular sign whenever this sign of course it will just split it and then string size factor is going to false and it will create a dataset so John was to gets what it does it is actually breaking if you change honors if it is adventure animation children comedy and fantasy so adventure animation children comedy children comedy and fantasy so that is how it has broken and the rest of them are blank so we have created and if I just column names of John Orr's 2 if I make it 1 to 10 now it will be clearly seen that I'm actually breaking the joiners of each column into separate separate columns so these are my various joiners and if I find out the unique of these donors in there whatever they are in this one thousand three thousand ten thousand three hundred twenty nine observations of ten variables you will basically get 68 sorry eighteen different kinds of John are so these are eighteen different kind of journal that is coming up so that is a journalist that I we have and based on this journal list I will create a matching so weather weather what is the code for this particular genre so if this is the first particular movies genre so then I will create a matrix in such a way such that that matrix will have number of movies is ten thousand three hundred twenty nine so ten thousand three hundred twenty nine rows and eighteen columns it did column since each is ones honor and the value will be zero if that particular movie falls in that journal and that data will come from this particular matrix and if it is not in that Johnathan's zero if it is in that journal then one so that is what I'm going to create now so what I'm doing is that I am creating see there's a matrix of zero with ten thousand three hundred thirty that was fast true will be the column name and eighteen columns so that is what I am creating the fast road general matrix one the first row is basically the journalist the column names and then column names of journal matrix is basically the journal d so that is what I am doing here so if you check the journal matrix right now it is basically all zeros okay and then what I'm doing is for us I is equal to 1 to n row of Jonah's to that means ten thousand ten hundred three thirty and then C is equal to 1 to n call of journals two that means 1 to 18 what will I do if it is matching then 1 otherwise 0 so if I just run this thing quickly and then drop the first column first row see first row I'm dropping here if I just drop the first row then what do I get in genomic tricks - I'm getting geometric stood like this so the first movie is action animation children comedy the second problem is adventure children and fantasy and so on now this part you can do it in different way - if you have a better I'll go for that you can do it in your way this part is similar so I have to create this this is something that I want to know that which movie and with Joran I'm creating a mapping for that now next is for ce-1 - 18 in call of genomics - is 18 so C is 1 to 18 the journal matrix for each column I'm changing it to their integer values so if I just run this is doing nothing but changing all the values to their indigenous now what will I do I will check it create a search for a movie by jun'er so this is off topic but this isn't that helps me in developing further so I'm creating a data frame called ears which is the mobile movie title so ears is equal to as data frame movie title strings as false so ears looks like this so this is the movie title column basically and then I am I using library called data table - what to do to substring so I am saying that substring write is a function which will substring from left to right so this is what I am doing substring function and using the substance unction from here I will only take the years this 1995 this 1995 this 1995 I will scrape so you can do right how much from from right sight it's like the right function if you have used Excel it's the right function on the right it is the second - one two three four fifth fifth so it should start from two in that five so from right side that is what I am doing so years is equal to you see that one comma four basically is something that it is doing it is subtracting creating a subset and that years is getting me all this your values of this particular thing so again you can do it in Excel if you want but I am doing it here next is I will create the same thing with a movie so I am creating a search matrix which is binding movies data's first column that means movie ID next is substring of movies one two so the movie name basically only the movie name then the ears and then the journal matrix so when I put this and then put the whole column names this is the search matrix that I get the movie ID the title the year and then the johner ID matrix so this is what I have created from this I save this so that I can use it for later purpose so this is how it looks like basically the search matrix will look like movie ID title here and the overall genre of the movies so you can create a pivot in this particular matrix or you can create you can search like this subset search matrix action is equal to one that means it's a movie action and here is equal to 1995 but is that Idol of that if I find out so these are the movies which are which come out in 1995 and our action movies so if you want furthermore let's say I want action is equal to 1 and comedy is equal to 1 and 1995 so this is the movies which are action and comedy so you can create those kind of search now what I will do next is I will create a binary rating so create a user profile is what is my next objective so I'm creating binary ratings anything 4 & 5 is high three two one is low so that is what I am creating here so binary rating is equal to ratings and then for if the value is greater than three then put it 1 if it is smaller than 3 then minus 1 so that is what I am just trying to do likes means 1 dislikes means minus 1 so it will runs for some time and let's see how much time it transfer ie in 1/2 in row binary ratings binary ratings is 1 lakh so it will take quite a bit of time to totally find out so I will see it is now a 28,000 and what I am trying to do here basically it will go up to 1 like what I'm going to do is that sometimes it does not matter if there are multiple gaps that have 1 2 3 4 5 multiple levels of ratings creating similarity becomes very difficult sometimes so 1 minus 1 is basically ah more or less I would say dichotomous so if you like one if you dislike minus 1 and why did I take greater than is equal to 4 4 or 5 because of 8 times you have seen that the reviews are a little bit positively skewed in nowadays so if it is positively skewed so 1 2 3 is considered to be low and 4 & 5 is considered to be high and we are actually trying to do that we are in 98 thousand one lap five thousand will take okay so it is over so I have created a binary rating so how does the minor in ratings look like the binary dings look like this basic thing 1 or minus 1 nothing else so you can so this code is actually bad you could have Donna if else simply fails would have taken much lesser time anyways so then what I do is convert this binary rating so what I will do is I will convert venerating matrix to it correct format so the format is like this value nettings to which I run and it will create a binary ratings 2 which is the movie ID and then correspondingly there are lots of people 669 variables will 60 16 observations all these NS means nobody has given review for that and if they have given some rivo either it is positive or negative one means positive minus one means negative so that is what I have got so basically ten thousand three hundred twenty-five movies and sixty nine users I will got a zero one matrix for that so it's a large matrix actually and then so if by chance if there is nothing there then if there is a na then put a zero there basically so I am putting zero for all the values where it is in E and then remove the movie ID column so that means I am getting a ten thousand three hundred twenty-five observations which is the movies 668 observations which are the users and 0 1 and minus 1 this is the three values that there 0 means there was no rating one means he liked it minus one means he basically disliked it so that is a binary rating formula that I have created now remove rows that are not rated from movies data set so there are certain movies which are absolutely not written by anybody so if they are not rated by anybody why should I use them so we are doing that and then movies rows that are not predict for general matrix to also so any movies which has been not rated you have to remove that from John a matrix to also that's how I'm creating John a matrix 3 so genomic tricks 2 to 3 D there are four movies which were not rated ten thousand three hundred twenty nine ten thousand two hundred twenty five so that means therefore moves which were not rated we removed them similarly movies to basically I have ten thousand three hundred and if I there are four movies which were not traded by anybody we demote them fair enough that's how we are reducing the rate at six so the calculation takes less time then what calculate the dot product of the johner matrix and the ratings matrix and obtain the user profile so understand what is the genre matrix Jeremy tricks is ten thousand three hundred twenty five of eighteen John errs whether this movie is belonging to this johner and then what is my rating matrix rating matrix is basically ten thousand three hundred twenty-five of our various people giving a rating now if I want to find out that whether this user is fond of comedy then what will I do I have seen that this user this 668 from this binary matrix this one if I just click on this one let's see who's there number one and let it come and then I will say there is a user number one whether he so loser one number one if you say that ten thousand three hundred twenty four all that seems the number two there because the data say data is showing here he has seen this movie he has not liked this movie he has not liked this movie and if you come down for that he has liked this movie so some movies user number two liked some visitor number two did it like and then all these movies like movie number fourteen if I go to journal matrix I know that movie number fourteen is basically a new number fourteen nobody we basically is a drama movie which he liked and then it's also it's only a drama probably then let's say this one which it didn't like which one was that that was movie number three or movie number five we didn't like so in the geometry sino movie number three is basically a comedy movie number five is also a comedy and movie number three is nothing else probably demands also movie number five is not romance so number three and five both are comedy which the user number two didn't like so from this information I can find out what is that he is Nate liking the overall liking of a journal how will I do that which movies he has seen with John or --'tis from there I will find out how much is rated for them plus one or minus one so that is what I'm going to do here in the next set of calculations so I am creating a result which is eight T comma six exceed five 18 that means 18 rows 668 columns each column is one consumer or one user and I am saying that whether here so it's basically a sum of ones and minus ones whether he has si a movie in a particular Journal if we'd liked one if we disliked - one if the net sum is positive then overall he is liking in the net sum is negative then over only is disliking that johner so that is what I am populating here quickly so result yeah forgot I got this result column so now if I just see this matrix carefully what I get is user number 2 don't user now is Rama one likes the first John almost twenty eight then 6th jhana the 8th jhana and probably 16th John are these are the journals that is the number one likes he's the number two probably this one six second owner ninety honor now if by chance see there are two guys who are this number one is a movie buff he watches more movie so the one who which one he dislikes likes a nine he still much higher than the most liked a one for the second user which is nine here so he is nine and this nine has to define meaning for the user to this nine means that he likes the eight John are most and he does not watch movie much on the other hand this line means that he watches movie very much nine rating is actually in comparison to twenty eight twenty seven twenty seven they're very very small so it is not his favorite genre though the overall rating is nine so for how to check that situation I have to normalize that so I am doing that first of all convert them okay so I'm converting them to 0 and 1 if it is smaller than 0 0 if it is greater than 0 1 now I am creating the data set which will be used by this recommender engine that recommend a lab library to create the recommendation engine so what I will do is I will create a rating mat the library called reshape and rating that is getting created an editing matrix is a large matrix which looks like this let me just put it up here which is nothing but a reshape version of of the data set that we have created till now let it come so if you check it carefully it is saying user ID - movie ID and the value is rating user ID movie idea the value is rating that is what is getting plotted here and rating Netflix all these ones are basically the user IDs in x-axis and y-axis is movie a movie ideas okay so it is taking a little bit higher time okay so the view is not coming properly I will not focus on that and then the method is use a BF see similarity calculation does not cosine similarity that is what we are doing nearest neighbors remember there we took five neighbors here we are taking up to 30 neighbors the library is recommended lab the rating matrix is we are converting it to a recommended lab sparse matrix so these are basically specific to this particular library you have to use this you have no choice and then the similarity basically similarity of the users is similarity rating mat 1 2 4 method is cosine which is user so you I am doing user to use a similarity matrix and if I try to find out a similarity score for the first four guys this is how it looks like so you have taken fast for you can take the whole 1 2 6 6 8 it will give 1 2 6 68 I have taken the first row for the simplicity of calculation and this is what I am getting the image the similarity matrix so the yellowish it is the better that is the image that we are getting so this one is not coming has to be good we have to check the rate colors again once more then I can also find out the computer similarity between the fast for movie so I can do it for the movie by movie similarity also so for the fast for movie if I try to find out the similarity this is the similarity see point nine point nine five point nine one so the first room with a very similar probably with each other now explore the value for rating so this is where I actually trying to find out the the the ratings the value of ratings so Victor ratings is equal to as victor rating Matt dollar data sorry at the rate data so this is a different format for sparse matrix and unique of it ratings these are the various vector ratings that you got five four three four point five one point two and so on and I'm creating a table for that and it will just show me what is the tabular ratings so vector ratings is these are the what how many vector ratings that you have got is something that has been listed here a vector ratings is not equal to zero I will only take Y it is not equal to 0 because zeros at any as if you remember so I am taking that and making them factor and then if I am plotting them by chance it is basically a histogram plot that how many different kind of ratings that I am getting here then if I explore the viewing behavior with a similar way I will get I will I will not spend time on this you will just check it I get a view behavior of the top 5 movies also so this is the top 5 movies viewing behavior and then if I visualize the matrix I should visualize this one a heat map so the heat map of the first rows and columns so this is the user rows and this item columns the darker it is the more he sees preference towards that based on the data said that we have got now what I will do is I will get rating mad if you remember the reading mat this is what I am coming back man spawn the rating Bank data set this is actually the one that I will use in my in my you see me up the recommender lab library so I am normalizing it fast and after normalization this is the values that you are getting the item columns and the user rows and all these ones are basically how the heat nap pod is the similarity level to 2-2 various items that videos how close it is how is the chance of seeing this particular thing and then I use UCB UPC if you we say means user based collaborative filtering and nearest number is going to 30 cosine is dealt whether it's going to cosine you can change this cosine into correlation and etcetera so that is how you get the model and you find out the details of the data so the modulus of the data says that there are sixty eight and ten thousand thirty five rating matrix of class real rating matrix with this many ratings has been used and these are normalized using center of rows now everyone to find out the recommendation the top ten recommendation so for the first person I am taking rating met one if we change this to two or one to ten you will get the recommendations for all the ten guys so recommendations for ten it is the top ten list for one user is something that is saved here in Raycom so if you check that I come basically the items and the ratings and the item levels have been written here so the next part is basically if you want to see that I come this is the recognized so Raycom underscore list is basically the first person the ID of the various movies and obtain the recommendations based on this recommends if I just try to find out the names then recoveries Earl will give me the names of the movies for the first guy so that is how based on you will see if you can check the code properly we are doing it now if you have to evaluate and if I am evaluate with n is equal to 1 is equal to 3 see one nearest neighbor Tartini are stable there's a five these are the three things that we are checking there's a three five ten and twenty five ten twenty these are the three guys I will check then how will I don it I will just run it like this so good rating is equal to five bad rating so run this the first rating is taking five nearest neighbor then it will take ten nearest neighbor then it will take 20 nearest-neighbor and what is the evaluation score and etc is something that we will see right now so okay so if I check that even evil results you will get it here so this is the even results for 5 10 and 20 corresponding true positive to negative rates and etcetera are giving here so the reference is this particular link you can get a better discussion about about the about this particular thing in this link I have taken the code from that link and probably the data set has been worst publicly available and this is how we create the recommendation in zip with rating data set with bigger data set in the next video I will also show you how to create a recommendation engine with a smaller data set which can still be handle level thank you very much I will see you in the next video 