 Topher's how many of you got to see rajesh is demo this morning we're ashram I showed password lists and the Microsoft identity platform well if you missed it don't worry this session is packed full of demos my name is leshawna Leppa and i'm a PM on the Microsoft identity team driving at registration experiences in the outer portal in my name is say dr. I'm a lead PM on the Microsoft identity team in charge of authentication SDKs let's get started before we get started I'll tell you about the Microsoft identity platform and why you're going to love it how many of you think integrating with microsoft's identity stack is easy well that's very little of you so we'll get started with showing a demo of how actually we have made it really easy to integrate with the Microsoft identity platform then we'll take a look at what goes on behind the scenes and how you get a lot of stuff for free without having to write any additional extra code then we'll take a look at some advanced scenarios like how to control user consent experiences and customize your customized your application lastly we have some release announcements and an update on our roadmap so what is the Microsoft identity platform first of all the Microsoft identity platform allows you to build applications that target organizational accounts also referred to as a Sheedy accounts as well as personal Microsoft accounts such as live and Hotmail accounts together this accounts for over a billion users and all of these users see a unified sign-in experience you can also use Azure ad b2c to sign-in users who bring an email or a social identity next the Microsoft identity platform allows you to build data bridge applications you can connect to any of your api's as well as a variety of Microsoft api's such as Microsoft graph we are on a mission to rid the world of passwords with technologies like when hello Microsoft Authenticator and 502 security keys future-proof your application by building on the Microsoft identity platform conditional access is one of azor a DS fastest-growing features it allows IT admins to do things like set policies where an employee is prompted for multi-factor authentication when they are not in the office builds on our platform to comply with these policies really easily you get all of this with a simple developer developer platform we've given you an easy a free education experience and a family of open-source authentication libraries and the best part is that this is an evolution of Azure Active Directory for developers that means all of your existing applications and AP is are not left behind they can interoperate with your new ones this ecosystem already has over a million active applications well when we asked you if identity was simple not many of you raised your hand well we're gonna change that it identity can be simple and we've made great strides and simplifying the developer experience I'm gonna show you what that looks like let's build an app Here I am in the app registrations portal in Azure Active Directory here's the list of all my apps I'm going to go ahead and build a new app you need to register your app with the Microsoft identity platform in order for your app to complete a sign-in process and they were for it to connect up to the service and you need three things the first thing is the name this is the name of the application that your end-users will see when they sign into the app the second thing is who can sign into the app so you see three options here the first option is all the users within your organization the second option is users in any organization imagine you're building a line of business app that any enterprise or school can use and the third is the broadest possible reach which is your application signing in any Microsoft identity whether it be personal or work or school and lastly there's a redirect URI that's necessary you can think of this as an allow list of safe places to send an access token we don't want to be sending an access token which can be used to access user data to any malicious app we want it to go to your app so I'm gonna fill these out we're gonna sign in any Microsoft identity and I'm going to leave redirect URI blank for now and we're going to run through a quick start that will create us a localhost redirect URI for local testing we're going to jump right to the quick store experience so I'd like to point out that this one Africa stration that you've created can be used for all of your app platforms you don't need a crap a separate app registration for web for desktop for mobile you can use one app registration for all the platforms of your application that you're building and this one Africa stration again can be used for any platform and any Microsoft identities signing in we're gonna build a JavaScript browser-based application also called single page applications now when I open this QuickStart the first thing you'll see is a diagram that explains the authentication flow and what's happening under the hood you don't have to understand any of this quite yet you can just follow along with the QuickStart and refer back to this once you want to know more so I'm gonna scroll down and I'm gonna go to the first step and the first step is to configure that redirect URI for localhost testing and to enable a flow called implicit grip implicit grant flow this is an authentication flow that's designed for building browser-based applications for single page applications I'm gonna click make these changes for me and I get to preview exactly what changes are going to be made to my app registration it looks good redirect URI and plus it grant flow I'm gonna make these updates and right away we get confirmation that this app registration is now configured with the necessary attributes to be able to run this QuickStart the next step is to download this project I'm going to open it in code now if I scroll past the HTML and I get to the JavaScript the first thing I see is the configuration the app registration that we created in the portal created a client ID this is a grid that uniquely identifies your application so it says enter the application ID here we need to grab it we've made this easy in the portal so I click copy I go back to the code I paste it right here I save this off and we're going to run it and we're not even time ten minutes in and we already have an application running let me show you that it works I click sign in and I automatically get single sign-on experience I hit accept and it's now giving me information about this user so I'm signed in with a worker school account it's calling Microsoft graph it's calling the me endpoint this endpoint returns information about the phone number the office you know first name last name that sort of thing let me sign in with a NS a Microsoft account this is a personal account now we're gonna sign it again this time because I'm signed in with two accounts I get an account selection screen to select my personal account or my work account I sign in with my personal account and again I get a consent dialog the for my personal account I need to trust this app to be able to read my profile information I click yes and great it returns information so let me show you what the code looks like in order to call Microsoft graph we need to ask permission to read data in the Microsoft authentication library the way you do this is by passing a scopes parameter this is a comma separated list of human readable lease privileged scopes that allows you to control exactly what data you need access to we need to call the me endpoint so this is a Microsoft graph rest API endpoint that we're going to call and I'm going to show you this pattern this is a common pattern you'll see throughout all of our quick starts and samples we try acquire token silent and if that fails then we do acquire token pop-up this maximizes our opportunity for getting a single sign-on experience and ensures that in situations where we do need interactive UI such as multi-factor authentication or consent screens that the app if it is unable to get a token silently pops the necessary interactive dialogue for the user to complete that flow that was simple wasn't it just a few simple steps were able to get our basic application configured first we registered the application by providing name which accounts we want to support in a redirect to your I then we were able to use a QuickStart for the platform of our choice to download the sample code and lastly we needed to provide the permissions and the best part is that you get a lot for free without having to write any extra code you get access to features like single sign-on token management password lists and satisfying conditional access policies well that's it folks you can go home but stick around because the rest of the session is about getting the most out of the Microsoft identity platform we'll talk about customizing your app registration this includes branding and a requesting access to more data we'll talk about permissions and consent and how the flows work from all the different perspectives from the user perspective from the developer IT perspective we'll talk about best practices to get great single sign-on experiences within your application as well as some security best practices and we'll talk about your existing investments and all those API is you have your own API is Microsoft graph API is other Microsoft API is and how you can access a diverse set of API is using the Microsoft on any platform so we saw that Syed configured a basic registration for his application but we'll take a closer look into what that experiences looks like and what kind of customizations we can make so we'll get back into this portal experience and I want to draw your attention to this list of applications here this shows a list of all of your applications that were registered with the Microsoft identity platform regardless of which portal experience you'd used now I'll go ahead and click into one of these this is the overview of the application it shows you shows you some basic information about the app like its application ID which we use in code to reference this registration it also shows us which account types were supporting that a redirect URI was registered some links to documentation and some steps to get started now we'll take a look at this left-hand navigation here we did a big card sorting exercise with developers to figure out how the properties of an application object should be grouped and we think we figured it out so let's take a look at branding this has all of the information associated with what your users will see when they're signing in and consenting to your application it has the name of the app a logo links to Terms of Service and Privacy statement we'll see later how this information is reflected to the end-user in certain scenarios an application needs to prove its identity it can do so using a client secret also referred to as an application password or even better a certificate you can configure those pieces of information here I'm going to skip over API permissions for now we'll see that in a second and move on to exposing an API if you're building an API you'll need to provide a unique identifier which was referred to as the application ID URI then you can go ahead and define your permissions here we have two permissions the payroll readwrite dot all permission and payroll dot read notice that the payroll dot read permission can be consented to by admins and users this other one we consider more highly privileged so we can only be consented to by admins not only do we have the UI we also have an API so the API can be really useful in some scenarios which is DevOps imagine that you need to roll keys from time to time another scenario that might be really interesting for the AP programmatic API as if you do need to do nightly testing where you want to build up an app go through a bunch of authentication and testing and then tear it down let me show you what this API looks like we're gonna use a tool called graph Explorer I can get there by going to aka dot MS graph Explorer now this tool is about exploring all the different api's in graph rather than having to write a bunch of code and then run it locally see if that makes any sense this allows you to play around with api's see the results and then decide ok yeah this makes sense for me I might have so I'm signed in with my work account here and if you want to see what api's are available you just go to this show more samples and see that I've turned on applications beta here that gives me this side panel and we have all the different API is example API is that you can run so listing an application creating a new application updating deleting we're gonna click retrieve a list this calls the slash applications endpoint with a rest get call and it returns the JSON result which has all of our applications including the application that we just registered earlier so in summary this gives you the most flexibility whether it's an API or the portal you have your choice we recommend if you're building your first application that you go to the portal and go through the experience first and then as you need DevOps or testing scenarios then you use the API we've mentioned permissions and consent but let's take a deeper dive into what these things mean as an application developer you request permissions for the data that your application needs access to but you don't actually get access to this data until a user or an admin grants consent consent is requested in the form of a consent prompt which you can see on the right it contains a bunch of data that the end user or admin can use to make an educated decision about whether or not they want to grant consent to your application for example it has the name of the application that's requesting access its logo its terms of service and privacy statement for the user to review and where the user can go if they change their mind later and would like to revoke consent when a user makes a decision here ultimately the IT admin can override that decision they can choose to disable apps in their ecosystem what this consent prompt also has is a list of requested permissions we'll take a look at how the developer can actually configure these permissions in summary consent is the broker between what an user wants what IT wants and what the developer is trying to do so let's take a look at the developer and IT admin experiences so we're back in the portal here and we're going to look at the API permissions section we can see that we're already requesting access to some permissions but we'll go ahead and request some more we'll click out of permission and here we have a variety of Microsoft api's to select from we can also select from API our organization uses or our own api's we're going to select Microsoft graph now we have a choice between delegated permissions and application permissions delegated permissions are used when there's a signed in user present so for example if I'm building a payroll application where my employees can sign in and see their payroll data I would use delegated permissions on the other hand application permissions are used when the application is running as a background service so if I'm building a payroll processing application that runs in the background I'd use application permissions for our purposes we're going to select a delegated permissions and request access to reading users calendars so we'll navigate to the calendars section and we'll go ahead and dig in and find the calendars dot read permission notice here that it's a lot easier to find the permissions that you need to request and you can see a lot of data about the permissions we'll go ahead and request the calendars dot read permission and go ahead and add it to the application when we do that it's now requested in this table of work of permissions and we get a notification that permissions have changed now this is just requesting access to these permissions but like I mentioned before a user or an admin has to actually grant consent for the applications have access to this data because I'm signed in with an admin account I can actually go ahead and grant admin consent for my directory I'm going to confirm the action and now we can see that admin consent has been granted for these permissions in my directory that means when my contoso users sign into this application they will not need to grant consent themselves now let's go ahead and look at what the IT administrators view looks like for an IT administrator when they navigate to the enterprise application section of azure active directory in the azure portal they see a view like this where they can see which permissions have been granted consent by their users they can see this data and they can ultimately choose to revoke the access or disable the application in their tenant if they decide that it's not right for them let's talk about some of the best practices from permission and consent first up you want to build apps with least privilege you don't want to be asking for a bunch of permissions that your application doesn't need because it becomes a target for malicious actors to try and figure out how they can take advantage of those over privileges next is whenever a user signs in you want to use user delegated permissions in order to access their data let's go back to the Quick Start in the Quick Start we asked for user dot read user dot read is a user delegated permission that allows the app to only access that user's data there is also what we call an app permission called user read all it allows you to read all user data inside the entire directory of the organization this is designed for situations like a background process or a demon app that needs to process all the data for all the users in the directory but it's not appropriate for your app to use when in the context of a user that is signed in the next stop is have you ever had that situation when you get a consent dialogue that asks for like 40 permissions and you haven't even used the app yet and you're thinking do I say yes to this thing what is it gonna access and what is it gonna do with all that data well nobody we have data showing that customers don't like this experience you want to build your application to ask only for the minimum of what's necessary to get started and see value in your application before you start asking for permission after permission and when you ask for permissions after they've interacted with the application it'll make sense to them in context why that permission might be necessary and they're much more likely to accept next regardless of whether you ask for permissions in your application upfront or whether you ask for permissions down the road incrementally within your application we want you to aggregate all the different permissions that your app ever asks for and configure them in the app registration on the portal why would you well so why do we ask you to do this there are enterprise and school experiences organizational IT administrator experiences where they want to pre consent your application for use within the organization so that their users never see a consent screen in order for us to do this successfully we need the full list the upfront the incremental everything and that doesn't mean that your app gets all of those permissions when it starts it doesn't it gets only the permissions that you asked for in code and the list in the average portal is necessary for IT administrators to click one button and pre consent everything that the app will ever ask for so if you follow this best practice it and an IT administrator pre consents your app use in the organization we'll never see a consent screen all of these best practices and a lot more are available on our identity platform checklist and this is great for making sure that your app is ready to get to production so I mentioned don't ask for all the things upfront and you may be thinking well that sounds complicated let me show you how it looks okay this is the QuickStart that you're all familiar with now what we're gonna do is we're gonna add another button called the share button now let me give you the scenario you want to maximize the viral nature of your app and get as many of the co-workers using it as possible so that you can go to your boss and say well it what a great job I did the whole organization is using the app so we're gonna add a share button this is gonna call graph and request a list of all the people that I work with and allow me to select one of them so that I can very quickly get everyone else into the app that I love let's start with the permission so we asked for user dot read user dot read upfront we're going to ask for people that read down the road and we're gonna call this i NC incremental for short then we need another endpoint so let me take this graph endpoint duplicate it this is going to be the people on point and now we're going to go to that function where I showed you we call a choir token silent and then call interactive we're gonna duplicate it now I'm sure you could do a much better job of not duplicating so much code but I'm hacking and slashing so we're no longer requesting our upfront permissions we're now going to request whether it's silent or pop up we're gonna ask for our incremental permissions and we're no longer going to call the gräfin point neat and point we're going to go graph people endpoint and now we need to wire up this function to a button so I'm gonna copy this we're gonna grab duplicate this line add a share button we're gonna call our new function share and while I get this running Lesha is gonna explain exactly what we expect to see so we expect that when we sign into this application we will not see a consent prompt at first because because we've already consented to those permissions when Sayid signed in earlier however when we click the share button we'll expect to see a new consent prompt that has the additional permissions he's requesting let's see if that's what happens I'm just gonna show you that this works with both personal accounts and work accounts so I'm gonna sign in and I get to choose any type of identity I'm gonna choose my personal and this is the first API grant call so we already consented we never saw a consent dialog just as Alicia said now we're gonna click share cross your fingers that I didn't make a mistake we get the consent dialog because we are now requesting access to read users of that are relevant to me my people list so all I have to do is click yes and agree to this and now we've requested permission we're able to call the people API and get a list of all the people that are relevant to me now that I have permission let's continue on with some best practices first up single sign-on nobody likes to see constant pop-ups saying sign in sign in sign in well we've really made this simple we give you two API calls one called require token silent and one called acquire token this is the common pattern that you want to use throughout your code it not only gives you the best single sign-on experience it also allows you to handle situations like IT policy so one of those situations might be if you if your IT administrator has set a policy to require multi-factor authentication when you're not in the office so what would happen is even though you are signed in and you try and acquire a token silently it would fail you would go to acquire token you get an interactive dialogue and then you would be able to complete the multi-factor authentication in that dialog and then get to the application so next up is best practices for security don't try and implement the protocol yourself we've made a significant investment in the Microsoft authentication library and dotnet middleware to make this super easy whether you're building an asp net app or whether you're building a client app and these libraries were built using Microsoft secure development lifecycle so take advantage of them next is clients should not be inspecting access tokens clients should be looking inside ID tokens for all the information that they need such as first name last name or you can customize your ID tokens to contain any information that the client may need access tokens are intended to go to the resource and if you start having clients you know poking into the ID into the access tokens to read information it prevents your ability to take advantage of other features down the road like encrypting access tokens to protect PII information only intended for the resource don't try and create your own database of usernames and passwords it's very difficult to get right there salting hashing operational security all sorts of issues to think about that are very difficult to implement correctly if you do need to build an application that signs in your customers with a username and password that they create or an email password that they create we have a great product called a sure ad b2c and emcell works great with it apps should never handle raw passwords there is a flow supported by the libraries called resource owner password credential grant it's there for some scenarios where it makes sense such as testing if you need an automated test that signs in a user this is a great flow but you should never use it in your production apps intended for end-users and there's a couple reasons why one is your app becomes a target for malicious actors if you're handling raw chickens so it becomes a weak link in the end to end security and remember if you have your password your consent dialogs are not going to stop an app from accessing data the other is this really allows you to take advantage of all the future innovation that comes from password list and from multi-factor authentication if you're using roth username and password you won't be able to take advantage of this all of these best practices and many more are available on our identity platform checklist and this is a great checklist to go through once you're ready to start moving your app to production to make sure that you've got everything taken care of let's talk about best practices for updating to the Microsoft authentication library first does we want you to write all of your new apps taking advantage of the Microsoft identity platform and the Microsoft authentication libraries the reason for this is that all future innovation is going to happen on the new stack and you want to be on the new stack to take advantage of this if you have apps that were developed for Azure Active Directory for developers using our active Azure Active Directory library or Adell we'd like you to update to the latest version of data and here's why we made a significant investment in a Dell and an M cell to make sure that your portfolio of a Dell and M cell apps get great single sign-on experiences together they have capabilities to read and write from a universal cache in order to take advantage of this you want to update your little apps to the latest version of a Dell even if you're not ready to move them to the Microsoft authentication library and lastly we're not ripping the rug out from underneath you update your apps to the Microsoft authentication library when you see value and when you do the apps that were previously built using a tile will automatically keep that user signed in when that user signs in with NSA oh I mentioned earlier that the Microsoft identity platform is an evolution of Azure Active Directory for developers to demo this we need an API that was protected using Azure Active Directory for developers we have a to-do list application that you may be familiar with because it's all over our samples it has a client and a server the client is stateless it just finds the user in and the server keeps track of to-do list items for the signed-in user we're going to use this sample to demo calling a diverse set of api's okay so what we have is this is the service running in the background it's in order to call the service you need an access token so it's not able to show returning data without a client that's configured to do that so let me show you the client the client I'm signed in I automatically got single sign-on and as I entered my to do list items here they are sent to the server so this the client is stateless it's sending all of this to the server and I have a list of to-do items that is associated to me and no one else great so this was built using Azure Active Directory for developers the API was protected using asp.net but going to our v1 endpoint and the client application was built using a don't know you've got this existing investment and your boss comes to you with a new idea and says hey we're doing a conference and we really need a kiosk and you say okay great sounds like an opportunity to take advantage of them sell this kiosk when you walk up to it you need to be able to sign in and see your list of to-do items but there's one problem this kiosk has no keyboard well since M cell net is now a true superset of the capabilities that existed in a doll net you have access to the full range of authentication flows including a flow called device code flow device code flow allows you to generate a URL which can be turned into a QR code and once you sign in using that URL or QR code on your mobile device which are probably already signed into then you complete the flow on the on the phone and you sign in and that kiosk will be signed in as well so let's go download a sample and see how this works so this is one of the emcell dotnet samples that we have on github so if you go to github /a sure - samples you'll find a bunch of different emcell dot samples this is one of them and I made just some minor modifications in order to call might reduce my to do list service and I'm gonna walk you through those changes so first is I had to ask for permission to access the data well in Azure Active Directory for developers a very common pattern was to ask for permission to access a service URI as the user or it's called user impersonation it basically allows you as a user signed in user to access all data behind a particular service so I'm gonna show you in the average app registration portal what that looks like we have two apps registered one is the service and one is the client one of the key differences of the platform that existed before Azure Active Directory for developers is that you needed a separate app registration for all the different apps in your ecosystem that's no longer necessary you can now use one app for everything so we could collapse these if we wanted to but there are some advantages of having two separate app registrations in this scenario imagine you wanted an API that has its own logical entity that can be accessed from a wide variety of clients some from your company and some from some other company it may say make sense to keep these separate we're going to go into the service and this is the API that's exposed so we're going to go into expose an API and we're going to look at the permission so this is just a default permission that was created when we created this app a long time ago called user impersonation and it basically allows the user to do everything read or write or anything that he wants to do with the tool service and if we go back to registration for the client and we go to API permissions that this app has requested you'll see that listed right here is that you do a service and the user impersonation so now we want to build our kiosk application on MSL net do we need an app registration well we can actually use this one even though this app is working today in running with a Dell we don't need to make any modifications to it we can reuse the same app ID with our MSL app so we'll grab the application ID and you can see that I'm using the same application ID here and we've set up I've changed the endpoint to be our to-do list endpoint and I've set up the scope so in Microsoft identity platform scoops are human readable and lease privilege scopes that existed prior for Azure Active Directory for developers were a service endpoint followed by a human readable least privileged scope so we actually have to concatenate them in order to be able to call this API this is the permission I need to ask for this is the pattern to use when writing an M cell app that accesses an API protected with the v1 and the same pattern applies here we try and acquire token silently when we can't then we go through device code flow and we're just gonna print out the URL and then the only other changes I made were very cosmetic I pulled in the to-do list class and I now have a display function to deploy display my to-do list items other than that I really didn't modify this example at all so let's go ahead and run this I thought about throwing up a QR code for everyone and having a race to see who could sign it first but then the real test would have been to see if they were foolish enough to accept the consent dialog and have their information displayed on the big screen okay so I'm signing in I want to get these side-by-side so you get to see it I get single sign-on experience because I'm already signed in I'm gonna select this account there's my to-do list alright let's talk about some of the releases and roadmap thank you to everyone that provided feedback while the app registrations experience was in preview I'm happy to announce that the new app registrations experience in the azure portal is now generally available you can access it at AKMs slash app registrations we are targeting GA of the applications the API in Microsoft graph by ignite 2019 and I'm happy to announce that Microsoft authentication library dotnet and Jas are now GA you can find all the samples and Doc's for M cellnet already pointing to the GA library and for MCAS they you'll see the samples and documentation pointing to the GA library by the time you get back to your office next week we've also had made a lot of progress on MSL Android and M cell iOS these are feature complete libraries but they have a dependency on Authenticator app and company portal that's going to be rolling out in a coming month to enable some enterprise scenarios where you need to do mobile device management so it's GA we want you to build an app who is betting on it within Microsoft let's talk about visual studio 16.1 preview as well as the dev tools so CLI powershell and the rest all of these have already integrated with emcell and they're benefiting from single sign-on experiences across all of these if you'd like to see a demo of this amanda has a session later today that where they show all the dev tools signed in in getting full single sign-on experience across them next in the demo this morning at the rajesh keynote a Shema showed the Authenticator app this is using emcell and I just showed graph explorer this is using M cell Jay s we also have api's within Microsoft that are taking advantage of the Microsoft identity platform to secure their API this includes Microsoft advertising as well as Microsoft a graph we want you to build your next application on the Microsoft identity platform so Microsoft is using it that's great but do we have any customers at scale that's scale hey you sir looks like you're reading your email on your iOS device Apple is providing a consistent user experience for all Microsoft identities reducing developer complexity and reducing support costs for signing in Microsoft identities on Apple devices let's talk about certifications we're on a mission to eliminate passwords and we're happy to announce that Windows hello is a phyto to a certified Authenticator we are also committed to standards compliance so I'm also happy to announce that the Microsoft identity platform endpoint is now open ID Connect certified lastly let's talk about next steps you can head on over to a kms forum to get started with our documentation we also have public office hours that happen every two weeks on Thursdays so you can join those to get feedback and get your questions answered sorry give feedback we also have a vibrant Stack Overflow community so you can go there post your question and tag it with Microsoft identity platform that's it folks for real this time [Applause] 