 wow thank you great room good crowd thank you very much your fell for the put back in the title twice gambit and get everyone in the room so that's good thanks for the introduction thanks for the opportunity to be here my name is Kevin done I'm a technical vp for NCC group based out of Austin Texas I've been an attack and penetration focused consultant for about 15 years spent a lot of time breaking into systems and into companies and also from different kinds of technology stacks and all different types of industry verticals I do live in Austin that's not my mugshot that's my visa picture originally from the UK Austin's amazing this 50 or so pounds of barbecue weight that I'm sporting is testament to that it's a pretty amazing place if you ever get a chance to go there you should I look after a couple of practices at ncc group one is called strategic infrastructure security and another is the incident response team so I get to look at both sides of the coin really I get to look at how we break into companies and then how we defend companies and how we stop live attacks from happening all that good stuff if I was to say I had a specialist specialism it would definitely be in red team pen testing in kind of like aggressive attack a model pen testing and a lot of stuff that I'm going to talk to you guys about today is based on what I see in the wild while i'm doing pen tests and some of the stuff actually came from as recently as this week so it's pretty fresh okay so what do I want to do of you today well I'll do a little bit more on a intro let you guys know little bit more about me in the company I work for I'll talk about though the major types of cloud services and the most common services in the cloud that we encounter and this you know that little asterisks is to remind me to say that it's based off what I see right as a pen tester so there will obviously be tons of others but these are what I see most often we'll have a quick chat about the benefits of cloud versus on-premises deployments lot of you in the room will be working for companies that are embracing cloud technology for a variety of different reasons and we'll jump into just a few ways in which you may do it or you may be planning I'm doing it the main meat of what I'm going to talk about though is obviously to do with security I'm going to talk about the concerns around cloud security I'm going to look at some pen test case studies some examples of what I what I see and what we use to exploit firms it's all going to be pretty basic stuff though and when we look at the lessons learned hopefully most of you will be able to sing along with me at the end when it comes to what needs to happen but what is not currently happening in the majority of firms so let's make start NCC group right I work for a company called NCC group we're a global security firm and what's great about working there is that we get to see so much we get to look at lots and lots of companies all trying to solve either very similar challenges or you know in some cases completely different and diverse we look at this thing called total information assurance we want to be able to offer advice on pretty much everything that your company does so whether it's around application security or whether it's around securing the company around DevOps whatever it might be or whether it's around modeling you know the ways in which you may get hacked and you may get compromised and showing how that actually relates to things like theft of source code or theft of IP or whatever whatever your biggest fears are that's really a key area for us and for me I'm based out of Austin but we have offices all around the US and if you don't know our company name you may know some of the firm's that we integrate it into NCC group NGS software intrepid asst group I sec partners and Matt Asano were all other brands that are now now fall under NCC group it's often quicker the name what we don't do than what we do do right but ultimately in a nutshell you know we we look at lots of things we look at lots of attacking and then also we look at incident response so whether it's attacking applications or users or buildings or networks it doesn't matter because I certainly believe that it's really about all of that your company is about all of that and focusing in on only one thing is often a little bit blinker than it means that things will get missed so anyway on with the show so let's talk about the cloud you guys have probably seen these types of memes and what-have-you right it's not the cloud it's just other people's computers when you think about security in the cloud this is something you really have to keep in your mind it sounds obvious but it really is like the main bearing of why security in the cloud can be difficult how much control do you have over the data over the system's over over all aspects so let's talk about though general deployment models that we see because the way in which you and your company use the cloud can be pretty diverse so when we look when we talk to companies and we look at what they do there are a number of ways in which they may use the cloud firstly we use cloud services to support a product and our customers quite a lot of people in this room I assume have that kind of model use a cloud service platform in order to support your product and your customers we use cloud services to support aspects of enterprise IT and our user base this is where you've decided as a firm to offset parts of your traditional IT into cloud service providers great example of this would be office 365 right put your exchange servers in the cloud etc etc we build cloud service platforms well ok that's probably speaking to a much smaller part of the room but certainly we do work with companies actually build the cloud service platforms that you use as consumers or we do something really new that you've not heard of yet well that's the beauty of consultancy right this happens all the time ultimately you end up talking to customers and then they tell you about something that really you didn't know what's happening this is happening more on the virtualization space for me things like micro perimeters and what have you and Sdn is really really big and really interesting and that's why I love being a consult when you get to learn about all the new stuff and see how people are implementing them so let's think about this shamelessly stolen diagram from Wikipedia number one right how many people's company still looks like this the traditional DMZ yep some people do raise their hands right because I recognized that for a lot of firms this is actually what they've been working on for the 20 years creating a robust outer edge a perimeter at the MZ such you can provide services externally while still protecting your company and things like you know the outer edge firewall and the inner edge firewall very classic design very important but for a lot of companies especially the ones that are embracing cloud technology and clouds service platforms it's not the seer this simple anymore right it becomes very complicated because they've offset things outside of the enterprise so the perimeter the crunchy outer shell is is not that anymore its jagged and it's relies on third parties and all sorts of interesting things so probably everybody here knows all the different types of cloud services but I wanted to start here and just kind of set the baseline and talk about the different cloud service types that you're probably familiar with or maybe you're learning about the first is obviously this thing software-as-a-service SAS has been around for a long time as a term but ultimately what we're talking about here is software as a service is a software licensing and delivery model where you don't have the software and the licenses on your desktop you have it you pull it out of the cloud great examples of this right at the bottom there salesforce com fact their logo is all about no software right this is trying to tell you something workday concur Citrix gotomeeting Google Apps WebEx all those types of things this is you using a software platform that's not on your premises its elsewhere so software as a service probably the one that most people use most readily for developers we're probably talking about the next category right we're talking about platform-as-a-service paths platform of the service is a category of cloud computing service that provides a platform allowing customers to develop run and manage web applications or other kinds of web application so this is where the force comms and the Haruka's and the google app engine and maybe apache Stratus those types of things come into play who in the room is using platform as a service for development yeah great excellent so this is a great example of you putting something that's critical to your IP into the cloud into the hands of a third party okay and then the last one the big one right structure as a service we probably all pretty much familiar with this this is where we are actually building parts of our infrastructure in the cloud this is the Amazon AWS is the windows is yours and other you know cloud environments that you know I definitely see less often than the first two but certainly things like rack open space IBM SmartCloud dell open cloud is another one people are making use of this in order to build parts of their infrastructure I'm pretty sure most people in the room will be familiar with this concept and are using AWS or as you or what have you one thing I did want to mention though in addition to these traditional kind of cloud services is an honorable mention to citrix it's not a cloud service at all but the way in which we hack it is often really similar to the way in which we hacked cloud services so I'll definitely mention some of this because the reason I do this is because there are often some really smug people in the audience that have not made any kind of move towards the cloud yet so they think they're pretty immune to everything I'm going to talk about and then when I say but you have Citrix they kind of bow their head and nod and and I'll show them that it's pretty much the same problem it's just something that's hosted on premises instead of in the claim so we'll take a look at that obviously if you're not familiar with Citrix allows you to have a published application or a full desktop in a virtualized environment and you know a lot of companies use it right so um all of that said the most common cloud services let's talk about what I see all the time on pen tests and they're probably not going to surprise you right there probably the types of things that you guys are using so office 365 pretty much wraps up all of the exchange and Link and outlook and onedrive all into a nice neat package who uses office 365 at their company right yeah that's what I'd expect to see especially where we are in the world right a lot of people embracing this and then you know we definitely see things like SharePoint you know you can have sharepoint in the client now that was traditionally on your internal network it can now be hosted by Microsoft on your behalf and then you know the file transfer stuff Dropbox and box and what have you those are those are definitely up there people are not having conventional file servers so much in their enterprise instead they're having cloud providers give them storage and then on the the chat side you know things like slack and hit chat and a few others those are coming out for collaboration people on the same team needing to collaborate these are the types of services that we see so as I said huge caveat on this this is based on what I see on security assessments and pen tests there are obviously lots more okay so when we think about why people look at using the cloud versus on-premises deployments there are like lots of reasons if you google for you know top 10 reasons for using the Kyoto or what have you you'll find that 10 is a small number because there are a list of 25 and more that tell you you know reasons why you you as a company may want to adopt cloud technology what I did here is there was a much bigger list that i got from vario common and really what I recognizes that most of it was talking about the same thing money and cost so this is a variety of ways in which you can probably reduce costs in your organization by using cloud service technology economies of scale increase volume output or productivity with fewer people obviously hugely debatable but I'm sure that there are plenty of case studies that support that reduce spending on technology infrastructure though I can definitely get behind that one right if you're offsetting your stuff into the cloud you probably don't have to have that exchange server farm or those file servers all that kind of stuff the third point is about licensing fees right so if you're using software as a service typically the cost associated with the per seat licenses of products that are in the cloud are different and different models to how you would spend traditionally for desktop and server software so perhaps that definitely works globalize your workforce on the cheap well maybe yeah because the whole point of the cloud is accessible from anywhere anyone more of an internet connection which is pretty much everybody in most countries so yeah this could be a good way and you don't have to fund things through corporate VPN endpoints and all that that terrible terrible stuff improve accessibility access anytime anywhere now the thing is when this is shown as a positive security people clap their hands together in glee right because that's also the thing that we we look for if it's now more accessible it means it's possibly more accessible to attackers and that's really the point of my talk and all of my experiences around cloud services it's about how easy can I get to your data when it's in the cloud versus when it's not in the clock when it's on premises less training needed well we definitely see this as well because everything is driven by a web browser and pretty much everyone in your you know work force knows how to use a web browser it's a lot easier in many regards you don't have to send your staff on training courses for pieces of desktop software that they need to do their job if it's something that's just accessed via a web browser in the clay we could probably think of lots more but everything that I've read everything I researched everything I've talked to people about it's mostly been about cost savings doesn't matter which direction you look in it's about how can I spend less money on IT and IT staff and all that good stuff ok so security concerns when it comes to looking at cloud service platforms or using the cloud for parts of your business I've broken it down into four areas four distinct areas that I see and I'll go into detail on on each of these ultimately though we want to be concerned with the platform itself how secure is the platform we want to be concerned with the data how secure is your data while it's on somebody else's computer effectively how much are you able to conduct meaningful incident response when your data is in the cloud and this varies greatly depending on who consumed and how you use it and then how is the cloud and the infrastructure you've stood up in the cloud exposing other parts of your business in non-traditional ways either via traversal or because of simply where you've put it so let's dive into a few of these the service platform itself you may think that's none of my business it's outside of my responsibility or you may think yeah i'm actually quite interested in that how well i have microsoft and google and AWS and what have you how well are they secured the actual platform itself what could go wrong with that environment and how could I be affected by it the devil's always in the detail certainly those companies engage firms to look at the security of their platform proactively that's excellent great news but there are skynet interesting little edge cases certainly to do with multi see which tier have you paid for our your servers stood up in an environment that's functionally the same environment as other people's servers or you have do you have a genuine kind of virtual private cloud for example those things could be important the other thing is that vulnerabilities can come from a few different areas when it comes to the platform itself it can either come from the software-defined networking part like how they've segmented the multi tentative environment and how they've created their network security or in my experience much more likely it comes from the thing that controls all of that so when you when we're talking really about infrastructure as a service here but when you spin up machines and you build things what's the way in which you do that it's through a web app right or through an API that's the bit that usually has the bug and I've certainly reviewed products for people that make systems like this and the vulnerability was in the web application that meant I could take down servers that are in other tenant enclaves that weren't mine for example huge problem but at the crux of it at web application problem should obviously speak volumes to everybody at owasp so the platform itself could be something that lets you guys down for sure the way in which your administrators and your users authenticate to the platform is also pretty key let's talk about this one though data security at the moment quite a lot of people seem pretty content with throwing their enterprise data up into the cloud if you think about exchange 365 office 365 fantastic great accessibility you know cost savings but what are you doing you're putting your enterprise company email in the cloud now I mean your risk management and your risk criteria or how you do a risk analysis to this may just stop at the point where you say it's okay I completely trust the cloud service provider with that data to handle it sensitively protect it from attack so on and so forth oh and also not look at it and Mark it to me based on it and all those nefarious things that could happen if that's where your rationale begins and ends that's fine i'm not going to tell you you're wrong what i'm going to say is that there are lots of companies that don't believe in that that worried about the security of their data when it's in the cloud whether it be drop you know because they're using Dropbox or box or some other file share or because of their email so it's an interesting problem certainly we've seen some products kind of spring to life around this concept I'm as a firm with product agnostic we don't push anything but in the interest of saying the things that I've personally looked at there are a couple of products like ciphercloud and valle teeth that look at how you can encrypt data in the cloud in a way that it's still usable by the CSP but not it's not visible this idea of search of an encryption and they have a variety of ways of doing it but the way you typically do it is you have a gateway product on premises which is where the keys stay the keys never go to the cloud service provider but the data is encrypted before it's sent up and when it comes back down and it's packaged in such a way that it still is an email when they can still use it and process it and search for it and deliver it but the actual body of it is encrypted with keys that you hold on your premises this is pretty interesting it certainly goes a long way to talking about protecting the data as it's in the clock the CSP and anyone hacking the CSP should only get the ciphertext they also have to hack you to get the keys off the box to then decrypt it so you guys have probably seen technologies like this they're definitely becoming more popular and they're cropping up because it answers this question of how do I secure my data my enterprise data when it's in the cloud and being handled by somebody that's not me incident response in the cloud as I said at the beginning this is an area for me to focus I run the IR practice and it's kind of interesting incidents obviously and events happen all the time the CSP that you're using whether it's you know in a full-blown infrastructure-as-a-service perspective or some other perspective I mean how how good are they at working with you with an anon an incident response engagement and it definitely varies in my experience but some of the questions you need to be asking yourself around can I get hold of the logs what do they log how often is the logging overwritten all of that kind of thing can I get access to like what's the lead time on getting those logs can I get access to memory snapshot sky get access to the actual images for the server's themselves so that I can have somebody provide perform forensic analysis on them the case all the answers to those points really do run the whole range sometimes absolutely is the answer and to a very good acceptable level and other times it's not that so you do have to think about that also you had any visibility at all of what's happening up there do you have any kind of real-time telemetry from a traffic perspective or any other kind of logging because a lot of firms obviously build their own security operation centers their own socks so how do they get visibility of what's happening up there these are all really important considerations I would suggest for when you put your enterprise data or your customer data in the clay okay so what about this idea the last last area how do your users access the cloud data how do your administrators probably more importantly access it what form of authentication you are you using you know are we talking about web application consoles are we talking about ap is are using keys are using multi-factor authentication what are you doing very very important because the point is and when I design pen tests that are attacker modeled the point is what can happen if an attacker gains access to this system as a user and then conversely what can happen if they gain access as an administrator these are things that we prove all the time through pen test and I'm going to go into examples of this in just a second the other important interesting thing is interconnectivity if those servers in the cloud get compromised in some way what where does that get the attacker are they kept in the cloud environment or are there traversal inroads into your real enterprise and why I've certainly worked on pen test where the second was true compromising servers in the cloud meant that I could traverse into the real company on-premises environment obviously a huge problem I'll jump into all of these when we look at these case studies so this is what I wanted to go through I wanted to look at accessing sharepoint accessing cloud storage enterprise email we want to look at the the cloud data centers themselves how we can compromise or how we have compromised those and I want to look at sneaking in via domain trust the last point really that I just mentioned which is if I compromised something in the cloud where do I go how can I get further into the company sometimes yes sometimes no and then just for the nostalgic pen testers and the smug people will look at a quick old-fashioned Citrix hack which is pretty much essentially the same type of hack but first okay so ultimately I've spent my career doing penetration testing and lots of ancillary things associated with that but what may surprise you is that the things that almost always work when we do an attacker model test when we try and do a really aggressive pentest other things I've got up here really basic things that worked 20 years ago we ultimately use these these approaches we use password guessing believe it or not we use targeted spearfishing people will still fall for phishing emails and they will do your bidding based upon it and we use social engineering yes we call people anyone that's expecting really detailed advanced penetration testing techniques from me or during this subject are gonna be disappointed because it's very very simple why do we do it because it works almost all the time and it really doesn't matter who you are doesn't matter if you're a small organization or a large one these techniques still work and they still allow me to get the things that I need to then access systems and predominately obviously we're talking about systems in the cloud at this point single password guesses the amount of time I can find an account that has the password welcome one or password one or summer 2015 right now is amazing I mean it's this is what worked 20 years ago it's what works now and also you know single password guesses we're talking about we're not going to lock out any accounts by just trying one of these so if it's as simple as this then really all I need is a user list and then I can do this right I can do this against the live biotype I can do it on the internal network whatever it might be how do i get my user list OSN right open source information gathering techniques effectively I use LinkedIn to find out who works it works at the company I use document properties for to find out what their you know user name looks like and then I build a list based off of that and then I just run a single password guess and all I really need is one right hopefully I find somebody that's pretty privileged but usually with this kind of thing we're probably talking up like not often I t or security staff although we have hacked IT and security staff in exactly this way spearfishing so everyone thinks they know about spearfishing and that's great because everyone needs to know about it but when we do spearfishing is part of a red team or a pen test we make it a little bit more aggressive it's all payload based rights all based on I don't I'm not doing an engagement where I'm just gathering statistics and saying oh yes you know ninety-four percent of your workforce clicked on the link and then was shown a video or my elation have clicked on the link know when they fall for the phishing attack they get compromised and compromised is either they gave us their credentials for a credential harvesting attack or its proper see to its I have full control over their workstation right now because they ran the macro attached spreadsheet that i sent them that kind of thing and it is that simple this is an example of one that we use all the time ultimately it pretends to come from the IT team and we use a type of finding to then purchase domains look exactly like your domains but like Eleazar one or something like that whatever is available will purchase that domain and then we'll send emails from those sender addresses people fall for it the reason this one works so well is because it's about an upgrade everyone wants an upgrade and it basically says you know if you fill in the attached spreadsheet with your asset tag and all that kind of thing you may be eligible for an upgrade people sure as anything do that because what are we what do we know about corporate environments the laptop they're forced to use is usually busted and they want a new one so this works what about the attachment well it this is the attachment I use all the time it's an Excel spreadsheet and it's disgusting and gaudy and horrible colors because this is what IT departments do have excel when they make a spreadsheet in my experience so we went for a little bit of profiling there but ultimately you know Microsoft reckon that macros are bad so they don't run by default anymore but this spreadsheet says in order to get the asset tag to automatically populate enable the macro content and that's what people do because it's a lot easier than having to turn their laptop over and read the asset tag off and put it back you know so our software it does it's quite helpful it does take the asset tag and populate it into the spreadsheet and people send us the spreadsheets back and say when can I have my upgrade that's how you know it really worked but what does it also do it while it compromises their machine right we built an entire platform around doing this this is what it looks like these are all the machines that are currently under my control because they ran that that macro in the spreadsheet and it doesn't matter you see we've got some apple we got some windows we can we can work with both so this is excellent because now I have full control of their machine I can do things as them I can dump their credentials all of this is really around me getting you know their username and password so that I can access things in the cloud is then the last area is social engineering yeah it does it does still work obviously is this water yes it is why obviously people think that it doesn't but we have some very very good very highly skilled social engineering practitioners in our firm that and you think it's a matter of oh you'll just be called out of the blue we will work on campaigns building the relationship for multiple days multiple weeks to the point where you genuinely think that we are supporting you in something and then we get asked you to give us something so we try to make it as attacker model as we can based on what your threat actors are okay so all of that aside that's the precursor how do we do it very very basic stuff what do we do well let's take a look firstly lots of people are using office 365 as we as we already saw did you know is quite easy for me to find out which companies use it the Microsoft logon portal lets me do it right if I just put in foo at whatever company domain I'm looking at and hit tab if they use office 365 it'll take me to their login page okay if they don't it will say I can't find their login page this is at some information disclosure from an attackers perspective picking on coca-cola for no reason just at random right if we did this with the people in here that have a company that work and use exchange 365 the same thing would work I would be able to temp determine if I can find you or not the same thing is true with google apps for business so if Google other people running your email I can do the same trick it will disclose to me who is using it and who isn't based on domains so pretty pretty simple the other thing that's easier to find based just on Google searches is who's got their sharepoint in the cloud right this is an example of one just at random but you can see the bond we maybe you can't see it but it says this is sharepoint it actually says it so now i can do like really simple google docs right where i just build queries and just look for pages that have sharepoint on them and have a similar kind of URL path and i can work out who's got their sharepoint in the cloud same is definitely true of cloud storage right dropbox or box or whoever you're using it's pretty easy for me to figure that out either through social engineering or just attempting to log in and what have you but what we're talking about here is just a you know single factor web page just enter your credentials so when we actually pull it off right when we actually get a set of credentials for a user what do we now have well everything right if you're using exchange 365 this is taken from a pen test I've logged in as the user and sure enough what do I see everything I have their inbox I have one drive if one drives being used I can use link as then I can use instant messenger so what we like to do when we're if depending on the engagement scope we can ultimately just start sending emails as them now a nice technique is just to go through the inbox and find out if they regularly exchange Excel spreadsheets with people and then just trojan them and then send them out new copies of the spreadsheet and now I get even more shells this was all possible because for some reason I was able to get hold of their username and password and then use that to log in to exchange 365 office 365 what's kind of interesting though is that you can do a lot more with exchange 365 or enterprise email if you have the right level of permission for example if you can get hold of the credentials for the enterprise for the exchange admin now you have the ability to do crazy stuff in the cloud or against exchange 365 this is me using an open or using a SharePoint portal that was online that we got into with these creds to figure out which person has mailbox permissions and we just gelled all this together microsoft obviously makes it pretty easy for you understand how to do exchange administration against the cloud instance so it won't probably surprise you powershell right it's easy if you've got the right permissions to be able to add yourself a mailbox permission on a different mailbox so that's exactly what we did this is me running it and then ultimately I'm able to then get to that mailbox and send and receive email as that user the most important thing to take away from this is that this is definitely what we could achieve with regular old exchange hacking in the enterprise but where did I do this from I did this from my hotel room this was originally behind the VPN and it's not now it still hinges on me needing to have a username and password of course but I don't have to be on the network at all and if I got like username and password by doing a targeted spearfishing campaign specifically looking for that exchange administrator then great I did all of this remotely and I never need it to be the other side of your VPN ever this is the kind of stuff that pen test is love and you guys hate use names and passwords though it wouldn't be great if you only needed one username and password to get into lots of systems of course you can write people use single sign-on systems all the time this is an example of one login uses one magan no I'm just kidding Oh got you basically one login so you only need to login once and then you have access free sync web single sign-on to lots of things and in the case of this compromise user they had box they had blue jeans they had various other interesting things right even their benefits system all I needed was one username and password to get to their life their corporate life that's pretty pretty stark and like I said it's a pen testers dream an attack history okay let's look at some other other problems other things that we see all of your cloud data centers are belong to us basically what's interesting about infrastructure as a service and what it's around how you provision servers and how in who you let stand up servers and how often those standard builds those images get updated I've definitely seen a little bit of a dip in traditional infrastructure security and I'm genuinely just talking about patches and configuration especially when you let your developers manage that process I mean they do the same job as a sysadmin i guess but this is what we had reason recently we had systems that were stood up in the cloud that were missing classic patches that lent that meant that I could get a system level compromise on them and then do all sorts of like traditional pen testing things to get a domain admin token and compromise the domain in the cloud this all happened because it was missing patches I would argue that people that have the traditional DMZ make sure that they don't have missing patches on those internet-facing hosts because that was you know something we had a problem with like 10 15 years ago everyone realizes patched your stuff that's internet-facing when it comes to cloud deployments we're definitely seeing it creep back in that the security of configuration and patching on those servers that you bring up up are not up to date and are not necessarily good enough it can be a thing that really is the downfall okay lastly so this was brilliant I'm shamelessly stolen diagram number two from Wikipedia but we it's actually linked to the previous one so we went through this process of exploiting machine that was unpatched and then traversing onto it like they had a shared local admin password as well so you could get like pass the hash and get on to other servers gain classic pentesting 101 so we got onto other servers we finally found a domain admin token for the domain in the cloud and then we were able to compromise and take like the domain Sam off the domain controller in the cloud they had a full-blown infrastructure in the cloud short but then what they also had was the domain controllers in the cloud had a domain trust with the on-premises enterprise domain and an IPSec trust relationship access control rather that meant that if you were on the domain controller you could also just RDP into the real domain controller in the enterprise network so this is really light as bad as it gets and when we talk to the enterprise admins they had nothing to do with setting the cloud deployment up you imagine how annoyed they were this was like a huge gaping hole into their company and all because of the way the cloud deployment was set up it was a good day for us okay and then finally as I said old-fashioned Citrix hack for the nostalgic pen testers so lots of people that I talk to about this you know there's a number of them that always say yes but we don't have that we haven't gone to the cloud so we're in pretty good shape and I say to them do you have citrix externally exposed yes do you have single factor authentication does it just use a username and password yes okay well then pretty much the same kind of compromise as possible if I can get an account that lets me log in to the Citrix instance that you expose externally I get this right probably I get exposed published applications breaking out of a published application is like trivial to get to a real underlying desktop in the case of this one they actually gave you access to Internet Explorer and file its file explorer now when I run those where are those running they're running on the server they're not running on my machine so you've given me Internet Explorer and file explorer on a server in your network it's pretty easy for me to then just go to other places this is me browsing the SIS fall of the domain controller on the internal network through this exposure really really easy stuff I can then get a command prompt if I just use you know file explorer and just say oh no I don't want to look at my home directory thank you I just want to run this thing called you know windows system32 cmd.exe where's that command prompt running on the server not on my machine so we now have a command shell on us system that's internal inside the network I include this one but not because it's really anything to do with cloud security but because it's the same kind of hack if i can get a username and password and you've not protected their credentials properly then i can get into a system that will this time give me genuine direct access to on premises okay so i'll wrap up with some lessons learned and i'm pretty sure most you will be singing along with me with the last one authentication is really key before we get there though i'll go through some of the other points the easiest entry points still deliver they really do this is pen testing 101 this is not sophisticated rootkit malware thingamabob general control of assets is really important how much control do you have that your systems that you've put into the cloud data security and confidentiality are you comfortable with your CEO and your everyone's email being up in the cloud away from your control that's a good question and then exposure to enterprise systems and traversal into the company network through those systems if you rely solely on usernames and passwords to get into your cloud environment you have a problem you have a really big problem I walked in on the end of the last talk and on their lessons learned slide the first point was multi-factor authentication right mfa yeah absolutely that is makes it so much harder for me if you have that implemented staggering number of companies don't have implemented like most of them easiest methods to get username and passwords are still the same ones they always work guess them fish for them or asks for the ads for them you need to fret model the situation based on what happens if an attacker gets hold of the username and password for my exchange administrator the answer shouldn't be that they can act on behalf of the exchange administrator in the cloud it should be 0 but that doesn't get them anywhere because of XYZ if you don't have that that bit and you have the first bit you have a problem how much control do you have yeah you probably have quite a lot of assets control assets in the cloud would you have enough the trade-off is definitely important I would say it probably means that you don't put everything in the cloud you need to prioritize and I know that's really what firms are doing for cost if for no other reason forensics and incident response is is really really key it can range from being easy to incredibly difficult firstly your forensic examiners can carry out the forensic investigation in the cloud quite easily right so the process of acquisition for a virtual server in the cloud is actually easier I don't have to show up somewhere with a write blocker and take an actual you know this copy of the server hard drive you can create a snapshot and then let's say we're using why doesn't matter if we're using AWS or sure you can then share that snapshot with me and then I can stand up an analysis server and connect to that snapshot so you can actually achieve a lot of forensics virtually in the cloud so I don't want to suggest that it's impossible it's not where it comes harder is usually the logging side how much logging in telemetry and visibility do you have in your systems up there so that's really the one you want to look at in more detail Oh some examples yeah this is an example of taking obviously a capture energy if anyone uses a year they've probably done this many times so you can take a capture of the drive and you can provide it and we can work on it in the cloud your providers can work on it in the cloud same is obviously true in AWS guys have probably all done this taking snapshots of the drive if that's a system you think is infected this is a quickest way to have somebody look at it so data security I would say is something that should be on your mind as I mentioned before there are products to try to look at this it is not an easy problem to solve though because you need your cloud service provider to be able to process the data in some way but how much they are able to process it's really down to you so encrypting that data before it ends up in the clouds is pretty significant I would suggest on the last point here this is what you have to consider yeah you should only put data in the cloud if you can afford to either lose it or have it exposed does that sound like your email okay probably not so yeah something to consider for sure maybe it's not everybody's inbox maybe that's a better way to look at it who shouldn't be in the cloud okay um enterprise systems remember it's your enterprise data it used to be behind the VPN which meant I had to get into the VPN first or I had to walk onto your site and do some other way to get onto your internal network now I don't that's the key thing it's exposed in a way that it wasn't before how many layers of authentication are there between your data and the rest of the world if the answer is just a single user name and password i would suggest you've got a problem traversal paths now i'm not going to suggest that everyone's going to for file at the same problem that we've found where you can get directly in but you should definitely look at how are the servers in the cloud connected to my enterprise servers if the answer is not at all great if it's yes they are you need to look at how who can do that and for what reason okay the big one authentication and access control authentication for the cloud services is incredibly key most of you would have been thinking yes but if they had multi-factor authentication he wouldn't be able to get in based on the username and password that's generally true however most firms that we work with don't have that believe it or not and we work with lots of firms in lots of sectors they may have it as a minimal rollout maybe only some users currently have it or there's a pilot going on but really the uptake is just not where it should be most firms it's still a matter of if i have used name and passwords for users and they use cloud services i can get into those cloud services as those users lots of options exist really for multi-factor authentication google authenticator and areau duo Authenticator examples there are others with Google Authenticator it's open source so you can look at what they're doing but there's no support so you have to support it complete yourself we've duo it's closed source so you don't really know exactly what's happening but the support models there so in terms of being able to roll out to your enterprise maybe it makes sense maybe it doesn't think if an attacker gets credentials it's the multi-factor part it's the thing that's in their pocket the thing that I don't have access to that stops me being able to login stops then being able to login interestingly those a lot of native support there's popping up in the platform's themselves so you can do on the cheap I think I may 2014 was when Mike soft ultimately announced that everybody can use to a multi-factor authentication in exchange or office 365 using text messages previously it was only for administrators I never see this turned on I never see the stand on and I would argue that the overhead for turning on is pretty minimal everyone's got a phone so when you login with your username and password then text you the code and you put the code in the same thing is true with Dropbox they all are starting to have this if your company's not making use of that i would suggest they really need to look at it because the overhead is much lower than having to get something like Google Authenticator deployed one last thing though you've got to remember multi-factor authentication and two factor authentication whatever it needs securing in its own right and in most cases it's about where you put the seed files for those tokens recent pen test I got into a system through a vulnerability and then I had access to all of the Google Authenticator secret codes for all of the users so it's not a silver bullet you need to look at where do you put those artifacts they shouldn't be on systems that are either on the domain perhaps or maybe that can be owned in a different way this is where your vulnerability management program comes into play if you're using multi-factor authentication this part of it is key where are the seeds because if I have these seed files I can effectively clone that token and get in using multi-factor authentication as that user wow look at that exactly 45 minutes what a pro so that's that's what I had for you today I really appreciate the time if you have any questions just let me know so folks we have a microphone now for the questions so if you would like to ask questions to Kevin I'm going to ask you to line up behind the microphone after that we'll be having lunch which is happening upstairs at atrium and we coming back at 1pm for the next dog thank you you mentioned how the three basic attacks still work on almost all clients which I've seen as well and the first with the passwords you're addressing with a multi-factor but for the other two there were social engineering how are your recommendations changing with the fact that it still continues to be an issue yeah it was that involved for you definitely so I mean a lot of people will tell you that it's all about education of your users and yeah that's good but it ultimately doesn't solve the problem in the way that you want it to so for the exact for example it doesn't matter how much you educate your users not to give their passwords I via social engineering or not to click on links or run attachments in phishing emails they will still do it a number of them will still do it so you need to look at designing technological solutions around protecting your organization from your users actions when it comes to fishing that's often around things like filtering what they can get to so egress filtering and content filtering for the systems they can get to because if c2 can't get out of your network I can't take control of them if they can't get to my stood up weird version of your site because it wasn't on your white list that will definitely help so and when it comes to the social engineering fact I think it's about single points of failure right and inspect designing separation of duties such that you're privileged users that can do things on your network they have more than one account perhaps as cryptic account hygiene around that maybe they can give out or they do give out one of their accounts but they don't give out the real one because I know that's the the admin account so I think that it's it's not an easy answer I'm afraid but designing systems and processes to protect your company from the users actions is I would say more effective than training yes sir so besides their cost savings a lot of people move to the cloud because they believed the cloud service providers provide better security than you know non-specialized providers just general I teashop security shops and so forth do you believe that's the case after doing pen test that the cloud service providers do provide better security than in-house yeah I do actually the reason I say that is because the way we break in is not really anything to do with the cloud service platform in most cases is to do with the options you've chosen to turn on in this case the use of multi-factor authentication in most cases the fact that they are now supporting it natively in the the platforms itself is a huge step forward so I do think that most I would say pretty much all of the ways that we we have these successes on pen tests are not to do with the cloud service platform itself and the second question is you mentioned one login and they're a lot of young a lot of growth in that industry the IDS industry um have you and a lot of these IDs providers do provide multi-factor and so forth have you found anything specific obviously if you get into that account you get access to you know 20 30 50 systems have you found any kind of cracks in that particular space in terms of the security of SSO products themselves yeah yeah I mean obviously can't really mention any names but certainly we have looked to SSL products and we have found on abilities in them but obviously that's so so critical to their business model that they fix it immediately and you know ultimately it's kind of I think less of a problem than if you can just get into the SSO in the first place we're a really simple password thank you yeah thank you I thought it was worth mentioning so at my company we've done a lot with ssl providers we've used two of the larger ones one thing that they're a little bit bad at is actually looking for domains that are very similar to their own so in one logins example you might have though be a zero those types of replacements yeah we've actually had a lot of luck fishing our users internally and all over you just have to factor required still no problems by simply doing an engine X proxy in grabbing the session IDs it's a very simple trick and a lot of the providers aren't currently doing enough to necessarily make sure that these sessions aren't jumping from you know widely from one location to another so that's that's not where there's a little improvement yeah that's an excellent point and I should actually have said that we do successfully break in the systems where multi-factor is in place using techniques like he just mentioned but you'll probably agree it's harder significantly more difficult to pull off so but yeah very good point thank you Wow everyone was hungry huh yes sir one more we have a scenario where we use a single sign-on using one of the products which which allowed that to happen we are thinking about the salmon I want to see from your experience have you seen anywhere where the external client who is trying to do a single sign-on you know if they are happy if their system is hard how do we protect ourselves hmm that's a good question I mean and this is an example of where you've offset part of your security control to a provider right you're using a third-party single sign-on system in that instance I assume that the attackers actions and traffic are going to look genuine they're going to look like just a regular phone cases their God access to the user right exactly like you mentioned health benefits so if someone can see health benefits so the value of the IDP sided you call the IDP site if the credentials are compromised yeah I the service provider i'm in a problem you know because they can access someone else's data i hope you have you seen anything to solve these kind of issues yeah and unfortunately the answer is in how you monitor what's happening it's usually because it looks like the user you have to look at anomaly detection right in the users behavioral patterns that's one thing you would look at the second it's kind of like how the credit card companies do fraud analysis right they look for the ways in which you usually use the system and then you look they look for the ways in which you've actually started using the system and if you're an attacker you perhaps look different those are really the only kinds of things I've seen work I'm not right that's it I know you said one more question but it'll be quick I think what do you think about password managers like LastPass password managers are excellent however the way in which they used our sub exilim so password managers either on the personal standpoint like on the desktop or enterprise password managers or potentially suffer from the single same single point of failure if you're using single sign-on or weak master keys or weak master password to get into them they solve a great problem though don't they if you have to have if you have to remember more than one password for your job or for your life which we all do then having this place where you can get that data is important again though multi-factor authentication to the actual repo is the key so I've done a lot of tests where they've had enterprise password managers but that was on the domain and it was single sign on with your domains your domain credentials so once I compromise the domain and pull that person's hash out and pass it into ie and then go to the single sign-on side to the enterprise password management web page I'm logged into their repo with all of their passwords if they have multi-factor authentication I wouldn't been able to do that quite so easily the same is true i mean i run keepass on my machine but in order to get into my key pass you have to use a Yubikey so offsetting that factor I think is important okay thank you thank you hi I was just wondering if you could comment regarding any difficulties you've had with including these cloud services as part of scope and engagements because I perform penetration tests and that's you know that companies try and avoid including things in tests your clients do or the cloud service providing I some clients we deal with it we generally make them aware of the services then if they don't want to test it that's sure yeah somebody ought usually asks me that question and it's a good point and and something it goes in a few different ways sometimes people say to me aren't you hacking the cloud service providers and I say well no I'm stealing credentials from York from our client and logging in also you know most of the cloud service providers have pretty open agreement now about pen testing on their systems they've been driven that way by their client base from the perspective of talking to our clients though and when they say we say to them okay what kind of test you want us to do oh we want you to model a real attack at the pen test great okay let's just have a real quick like exchange of what you've got to use cloud services yes we do okay great we assume that if we get credentials we're going to be logging into those if they would say no at that point I would just have to ultimately say to them why you asked me to model what a real attacker would do if they're adamant that there's a ring fence around it customers always right right but you know usually when you go through the attack scenarios with them and say why this is important and show them what's being exposed I find that they usually are okay with it most cases I've not even had it come up that's interesting that you've had it come on well yeah I think it's a communication issue and exactly what you're proposing that I also think there's an important distinction between like what you said it credentials harvesting credentials and getting it that way and pointing shooting a web vulnerability scanner at a cloud provider right totally different yeah you have to explain that difference because yes some clients may assume that's what you're talking about and they'll say well this is a huge lie why are we paying for that it's a huge waste of time and money and isn't that illegal you know and you have to say well actually we're looking at something very different to that okay thank you okay thank you very much guys you're excellent preciate 