 okay next up we have Matthew lucky from kada hi this is what I've done well what has been going on for the round about eight or ten years now educator and what I'm talking about has been going on the work that I've done over the past sort of year this work that I've done with bread and mogan Casey okay no okay so what this talk is is about a project called is Frank which is available on the internet or no results through I've everyone into ice rink catered at all and what this project is is at first we infer is relationships going down the same road that number of other researchers have gone down over the years of using publicly available bgp paths so what we what we do is we download rubs from reviews and resin there's approximately 400 aess providing views to wrap use and resin about a theater than were providing full views and with the is relationship inferences we make custom provider peer-to-peer we then try and fear the influence of individual is is based on the size of their customer comb and the way to think about the customer cone as an operator is that a traffic that arise from a customer and then is transmitted to our customer so essentially the fraction of traffic that makes you the most money because you've been paid twice for it on net traffic so an overview of this talk I'm briefly going to talk about some objectives of of the work and then most of this talk is a methodology about how we go about it in order to gauge feedback for you about the validity of our assumptions so we're going to spend a lot of time talking about the assumptions about how they algorithm works and then illustrate the algorithm with a sample path and I'm going to show you some results and grass and I've got to sway at the end about how you can help so I think we can all agree that s relationships determine how traffic flows through the internet and having a set of accurate is relationships enables us what supports some measurement of of the infrastructure security and stability what happens f say one of the larger AES is with a large customer cone is disrupted what is going to happen in the Internet in terms of reckon versions how many parts are going to be disrupted so on analysis of Miss collegiate we miss configuration for example that helps to download case where if we're dodo starts announced with provider routes to another provider we shouldn't see this in the internet so having a set of accurate relationships might enable us to detect this automatically and what we're using it for is an analysis of the influence of a s is based on the size of the customer comb and again that's roughly what is the absolute number of a s is that a provider could charge traffic for so and this talk we focus on 28 relationships these are the canonical ones that I've always hold but they come pretty close customer provider where the customer pays a provider to have access to its providers appears and customers and peers where the asss agreed to exchange traffic between their customers with these set of relationships we assume that the cash flow follows from the customer to the provider and terms of BGP relationships we can't tell if peers the settlement free or paid peering I'd like to have feedback on that was the end but essentially money is flowing from the customer to the provider so the customer cone is governor governor set of chips for a ace customers direct customers are BNC but I provided that traffic reaches it from C will receive settlement not from D but will be paid to transit traffic from for example data if assuming it doesn't go across the peering link so ace customer cone contains B C D and E and F but not G which is across appearing link so the customer code contains customers as well as indirect customers so we have a set of btb powers on the left and a set of relationships we've and food on the right I'm going to present three different ways of constructing a customer cone and solicit your feedback on on each of them the first one is what's called a recursive customer comb so because we infer a to be a customer of be it might be natural to infer that a as an indirect customer of a except the bgp pads don't suggest that that is that be so that a has a path to be because we never see one so the recursive cone contains all of the aces in the graph five of them but if we look at what is observed in b2b pads we don't see a path from E to a so that follows custom provider relations are links so we infer that its customer cone sizes for and does not contain E but the computation is a little bit more complicated than that so a SS may have and a piece of feedback we've had repeatedly is that asus may have a customer provider relationship in one region but be peering elsewhere but when we assign relationships we choose a single relationship between two aces so when we infer a customer by relationship that overrides everything on the graph so even if appearing nearly nearly everywhere else we infer a single relationship customer to provider but using observed BBB+ limits the amount of damage that can occur so in this example we have x and y with region based relationships customer provider and type C and B have region based relationships a customer provider and and in the min America and peer-to-peer in Europe sobeys cone will contain F G and H using the observed cone become us are using observed b2b pars if we see that the pars across the peering link because we infer custom provider for between C and B overall but a scone will not a scone will only contain from see DNA because those are what we observe to see followed on a series of customer provider links so our third approach to defining customer cone might be to define it based on what we see announced to an asss peers and providers what we believe what's rate certainly to be the customers the actual customers so in this case because we see a path to a from B that contains D and E but not if G and H then we will infer B's customer comb to contain just D and E and C so with those with the customer code in mind there's a bunch of caveats again I've talked about region based relationships and we can't be on that we can't differentiate between paid peers and settlement free peers so a paid pier we do not include in the customer kind of an AS even though they are paying settlements to their peer even though one of the aces paying settlements but the PB that we've had in discussions with operators is that there's no routing difference that a paid peer is treated identically to a settlement free pier we don't know about traffic so if you're a large access provider and you have tens of millions of residential customers you're customer code is going to be small because your customer code is countered by iess so we don't hear traffic we don't have a lot of visibility and appearing to see all the pairing relationships in the graph we need a esas below the peering link and we don't have a lot of again 400 a SS that's that's about one percent of of all the aces and internet so we don't see a lot of pairing relationships the paths that the public data source that we use is messy again because of poison so weak minded for your relationships that don't exist because of poisoning and potentially also leaking and the size of a customer cone is not a metric of market power we need a lot more data than then customer khon2 and ferb market power but with these caveats in mind or maybe to keep you interested i'm going to present a few graphs so this graph is the observed customer cone time series from 2002 to 2002 october 2012 on the y-axis is the size of the customer conan a SS in absolute numbers that were observed over time and we see in this graph a number of cases that have increased in size I've labeled a few majors you can see on the bottom left where level 3 acquires Genuity and merges with them and up on the top right just recently we level 3 merged with global crossing so those are using observed pars and this doesn't cleanly deal with region based relationships particularly you might notice that there are spikes in the graph that aren't well explainable that these could be due to a single relationship being Miss and third or it might be that we don't have we have visibility sometimes but not others but perhaps that could also be due to us seeing periodically evidence of region based relationships so this graph is the customer code as defined by an asss providers and peers so this cone is likely to underestimate the size of ivan is because we are presumably missing some customers and pick me know we're missing customers but as treats all ace's equally in fact if you provide a view to route views then we have a good view of your is and that is reflected in the observed cone but in the provider and Pierre cone that view itself does not influence the size of the customer cone but what matters is what your peers and providers relate to us I'll relay publicly so in this level three the largest is has a customer cone that in absolute terms and two in late two thousand twelve is forty percent four percent of the internet and the observed cone the previous graph that's fifty nine percent so that's customer cone I'm going to talk about the relationship algorithms that we the algorithm that we developed we went back to the drawing board with this because and the ground truth that we'd collected over a number of years our relationship the algorithm we that we provided that are publicly for and a number of other ones did not match the ground truth very well so with that in mind we tried to develop a new one so I'm going to begin with a few definitions a transit degree so we use the governor set of BGP powers and a SS transit degree there's a number of a SS for which it provides transit for and we can't tell if the ISS but that they are providing that they are transmitting traffic between our providers customers or peers but what it allows us to do is to differentiate between large transit a SS and large edge I users that might peer extensively so this is instead of a node degree so and B's case B's transfer degree is for because it provides transit between a see sorry a C D and E but not if Angie and this is a of using bgp paths we have an assumption that there is a collective asses at the top of the hierarchy you may think of these as tier 1 a SS but these include more than just the t1i uses these include other transit providers that are paying that may be paying settlements to these other members of the click and a full peering mesh so we expect to when we earn our rhythm what we are looking for is for a link between and a s and all other members of the current members of the click and that there is no evidence that there is transit taking place that the transit is not being provided to a na s across the cliq some asss have a relationship with all of the of the tier 1 i'll throw all of the click but they receive transit from some of them so they we don't include those in the cloak our assumptions behind our algorithm is are as follows that we have that click at the top otherwise and then the reason this has to exist is that otherwise the internet topologies petitioned or a SS need to have relationships of all members of the cloak we assume that a provider announces customer routes to its providers this is the main point of paying provider to obtain connectivity to the rest of the internet we assume that the transfer degree of a provider is larger than n of its customer and this is a porter by our ground truth 99% of providers are larger than their customers in terms of the links that we see and that the topology graph in terms of providing customer relationships as they circulate that means we never see a as a customer of be be is a customer of si si is a customer of a existing relationship algorithms produce these things called strongly connected components and Alice does not and this is supported in our ground truth we see no a ptc cycle and our ground truth so a high level algorithm is that we infer the clock and and them Pierre appearing mesh at the top then we do some filtering of our btb passed an example of the function week we do is remove cards reserved a SS and we remove pars with is evidence of poisoning for example if we to see if we see to click a SS with a non click is in the middle of them that suggests that that the two classes are using another AST as transit but we know that they do not quite this they can exchange traffic between themselves so infer that the due to poisoning then we break our paths into triplets and this algorithm we are not seeking to maximize valid paths as previous relationship algorithms have done but we used the the basic unit of information in these and the construction and the paths then we visit a SS by then top down and order of largest transit agree and we infer a neighbor if a neighbor's write a customer to provide a relationship if a neighbor passes a router provider or if the neighbor is a member of the clock and it passes the route to another member of the clock and this gets us fifty six percent of all the all the graph observed graph relationships and food for their customer customer provider relationships and these are ninety nine point eight percent correct according to our ground truth there are additional steps in algorithm but essentially everything that we don't infer to be a custom provider is in food to be up here and that's thirty-seven percent of the graph and 90 x into those relationship inferences are correct so given a set of btv pars we have millions and millions and millions of these but given just this one we have a path involving 50 years I've labeled to them because you recognize these as AT&T and level 3 but to begin with so there's a directionality to the to a b2b path the information there outflows from the origin to the vantage point the vantage point is providing its view to wrap use and res we don't know anything about the relationships at this point but we infer in a previous step that AT&T and level 3 are members of the cloak and have a pairing relationship in them we label sorry then we break up the path into triplets and then we label each node with its transit degree what we observed to be its treasure degree so a in terms of the transfer degree apart from the clock a esas a as then followed by C and then as followed by B and then followed by C by transit degree then we visit them an order of transit degree so we visit a first now it might be natural to interfere that a is a customer of AT&T in this case because there is appearing relationship upstream from them but we don't make an inference based on this information unless we can this we have other things pointing us in that direction because it could be the case that AT&T is leaking routes p routes to a we would expect fa is a customer of of AT&T that they appear on the right hand side of AT&T and a BGP path because then that means that AT&T is announcing paths from a two other pairs and customers that's right other peers and customers and the net decision to do so has been validated multiple times and if we don't enforce this rule than our validation results go down so that's essentially why we do it we inferred thee as a customer of of 18 that's right level three because we see level three announce across the click so again if a it appeared on the other side where the appears now than we would have inferred a customer relationship but and thus we don't and we still might be inferring leap blinking but we can't do much about that when for cust see is a customer of B because we see see the CB announced to its provider routes from see so and we proceed so we had seven percent of special cases in our in our algorithm vantage points with no provider outs so like I said roughly two-thirds of a SS provide not a complete view FNA s provides less than five percent routes to listen typist end of a SS and we in fear that it's providing peers and customer routes and not provider routes and so we have a special case to deal with customer of right of relationships below them we have a case of course to deal with providers that have a smaller transit degree than their customer we have a case term for customers for a SS with no providers again our algorithm focuses on inferring providers and not customers but we have to do it for a essence that have no providers because otherwise we would infer no customers for them and a good example of that is transit rail and finally when all else fails then we are left with triplets where we have inferred no relationship and if we infer no relationship then we will fear both links to be peers and this may or may not be case the case so we try and collapse one of the two AES is down we tend to bias collapsing zeid down to a customer to provide relationship with why so in terms of our ground truth our efforts develop eight this we have assembled a set of 47,000 relationships we acquired two thousand of them directly through is ranked from 2010 22 2012 and what these relationships what these were submitted we're mostly pairing relationships our previous algorithm and third many more providers then existed and when an operator or someone with knowledge would visit the page but correct our false provider inferences to peers and essentially leave everything else so there's some motivation to do so we used the routing our psl database from ripe to to extract a set of customer of writer relationships because there might be some out-of-date relationships recorded what we quiet is that they have been updated within the last two years and that for each link we have a and B we expect to see a expressed that be as a provider and the rpi silence would be being expressed that a is its customers so we have high confidence in these in this set of ground truth and finally we have a set of relationships extracted from bgp data using community values there's we assemble a while pusillus assembled a collection of roughly 40,000 relationships that are expressed and bgb communities as defined by operators so these are published and web pages and in whois for approximately 230 a esas and so roughly two-thirds is provided customer and a branch with overall to theses provided customer and a third peer and validates approximately thirty-eight percent of the graph in terms of how we do and how other inference algorithms do we're very accurate and fearing both provider customer and peering relationships ninety nine point six percent of provider customer relationships that we classify as provided customer relationships are what we say they are so point four percent of those appears you might notice down the bottom girl has a very high positive predictive value for peering relationships but like our previous algorithm may include many more providers they need then in reality so they have a very small set of peer to peer relationships and the small set validate well but the provided customers don't do so well so this is the clock that we've been feared to exist over time what we're looking for because we don't have a good set of ground truth for who is in the click on who is not what we have is what we're looking for is as some semblance of stability so mine of the a SS have always been in the clicks for the past 11 years we've seen some that have been merged for example down the bottom level of ice one WorldCom went away and more recently there have been a esas particularly in Europe that have appeared to be in the clique because we don't see any transit relationships for them but this might be a limitation of our bgb data we're not sure and what we've plotted here is a graph of the three largest a esas as they stood by customer code in 2002 january 2002 and the three largest now so i potted for the third line cogent but cogent looks roughly the same as in teluk went and what were the other ones are we have to see it sorry they look roughly the same as in teluk want and there's others TeliaSonera so we have seen from 2002 the birth of three very large guesses in fact maybe five or six and the ones that were the largest 10 years ago are not so large based on the size of their customer comb and level 3 has a proximally forty-four percent of all ace's in its customer cone and that's been relatively static for the past eight years again this is our provider and peer to find customer cone this is what the previous graph is based off except now we're showing absolute numbers and again you'll see to the right cogent and telechron intelius aneri roughly the same size and their lines for a roughly the same pattern if you can pick them out I'm happy to show you this graph afterwards so in terms of what we'd like help for from men are like to know what it is that we have not thought of like to know we'd like to have some information about how prevalent paid peering is we've received some amount of indications of paid pairing but not enough for us to be able to come up with any methodology about how we might distinguish a paid pair from a settlement free Pierre and in fact we're not even sure that we can do so the bgp data relate with us and what's one of our assumptions is that a customer is announced to a provider's providers and what situations might this not a cure we'd like to know something about how prevalent complex relationships are so if you can provide us with ground truth information about relationships you have with a esas where they are provider and one relate and rent one region that peering and another we'd like to hear about that I would like to know what the granularity of complex relationships are as a region-based thing we've hit Express mostly in region and our feedback but it may be it's at prefix as well in ideally more vantage points of rappers and res and additional ground truth and with that questions we do have time for questions or comments trib used in a panic in this study your kind of treating every a s as an AS right but I notice in the allocation statistics the in the asia-pacific region there are only five thousand one hundred a esas that are allocated yet in North America 15,000 and in Europe in the Middle East 18,000 so it seems that an AS isn't an AS and that while in some parts of the world nodal notably in Europe AS has actually expressed a relatively fine grained degree of routing policy whereas in other parts of the world a SS encompass much much larger sets of users and policies how does your study relate to this difference that we see in the use of a esas across the world it treats them all as equals and that's a limitation again we don't have traffic which is essentially what we want whether or not this can be used to as an as a proxy I don't know as a simple observation somewhere in that massive ranking of huge providers you would expect to see something like China Telecom but they're phenomenally notable by their very absence in any such ranking and it kind of wonder how you would integrate different regions uses of a esas into this I guess we would need additional information in some way to express that as a rule so we need more ground truth I better go more of my can you go to the questions Lee so you're asking questions here that you know how prevalent are complex relationships how prevalent hearing and things like that there's what 40,000 ish AAS is available in the global table for 30-something thousand 35-39 thousand of them the answer is zero to all of the above so if you limit yourself to a much smaller set than the questions become nearly one hundred percent the complex relationships have even the people the networks that you had in that slide the very large providers are massively complex I mean look at just what level three announces through press releases in the fact that you know cogent sorry Comcast got them to somebody here works for coaching is going to piss to me now so the fact that level three puts out a press release saying that Comcast force them into peering as well as having a transit relationship and things like that so these are all you know well known as ground truths as you say but the problem is that you're treating everyone the same when in reality the very very top ones have complex multilateral relationships and like Jeff pointed out you know bgp works on a prefix asses are convenient grouping but clearly it doesn't work that way if you just strip out the bottom 90 something percent of them and concentrate on the complex ones you might have a better shot but then you have to be your algorithm your procedures have to be far more flexible and complex if you want to do just the bottom ever however many there are then these things become much easier and everything you say holds easily does that make sense yeah okay what's the chances of you doing that on a per prefix basis for level three that's what I thought thank you let's thank the speaker 